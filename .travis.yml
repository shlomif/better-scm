# This file was generated by ci-generate / CI::Gen
# (See https://github.com/shlomif/ci-gen-framework )
# Please do not edit directly.

addons:
    apt:
        packages:
            - ack-grep
            - asciidoc
            - build-essential
            - cmake
            - cmake-data
            - cpanminus
            - dbtoepub
            - docbook-defguide
            - docbook-xsl
            - docbook-xsl-ns
            - docbook5-xml
            - fortune-mod
            - gperf
            - graphicsmagick
            - hspell
            - hunspell
            - hunspell-en-gb
            - inkscape
            - libapr1-dev
            - libc6-dbg
            - libcmocka-dev
            - libdb5.3-dev
            - libgd-dev
            - libgdbm-compat-dev
            - libgdbm-dev
            - libgmp-dev
            - libhunspell-dev
            - libncurses-dev
            - libpcre3-dev
            - libperl-dev
            - libtidy-dev
            - libxml2-dev
            - lynx
            - myspell-he
            - optipng
            - perl
            - pysassc
            - python3
            - python3-pip
            - python3-setuptools
            - silversearcher-ag
            - strip-nondeterminism
            - tidy
            - valgrind
            - wml
            - xsltproc
            - xvfb
            - xz-utils
            - zip
cache:
    directories:
        - $HOME/perl_modules
        - $HOME/tidyall_d

deploy:
    cleanup: true
    file: site-dest.tar.xz
    on:
        repo: "/"
        tags: true
    provider: releases
go:
    - '1.16.x'
os: linux
dist: focal
rvm:
    - 2.7.0
before_install:
    - . .travis.bash --cmd before_install
install:
    - git clone https://github.com/vim/vim && ( cd vim && git checkout v8.2.2918 && ./configure --with-features=huge && make && sudo make install ) && rm -fr vim
    # Taken from https://github.com/brad/Inkscape-OpenSCAD-DXF-Export/blob/master/.travis.yml
    # Thanks!
    - sudo add-apt-repository -y ppa:inkscape.dev/stable
    - sudo apt-get update -qq
    - sudo apt-get --only-upgrade install libnss3
    - sudo apt-get install -qq inkscape
script:
    # Taken from https://dev.to/hiro98/how-to-use-the-systemd-userspace-dbus-api-on-traivis-ci-lag
    # Thanks!
    - sudo apt update
    - sudo apt install dbus-user-session
    - sudo apt install at-spi2-core
    - systemctl --user start dbus
    - export DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$(id -u)/bus
    - export XML_CATALOG_FILES="/etc/xml/catalog $HOME/markup-validator/htdocs/sgml-lib/catalog.xml"
    - TIDYALL_DATA_DIR="$HOME/tidyall_d" bash -x bin/run-ci-build.bash
    - tar -caf site-dest.tar.xz dest/
    - set +x
services:
    - xvfb
